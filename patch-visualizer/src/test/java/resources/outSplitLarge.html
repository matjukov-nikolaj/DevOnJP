<!doctype html><html lang="en">  <head>    <!-- Required meta tags -->    <meta charset="utf-8">    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">    <!-- Bootstrap CSS -->    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">    <title>Hello, world!</title><style type="text/css">code {white-space: pre;color: black}</style>  </head>    <body><h3>From: matjukov-nikolaj <blatnoi.kolyan@yandex.ru></h3><h3>Date: Wed, 26 Dec 2018 19:06:07 +0300</h3><h3>Subject: [PATCH] 2</h3><h3>File name:  FormulaCalculator.java | 73 ++++++++++++++++++++++++++++--------------</h3>      <table class="table">        <thead class="thead-dark">        </thead>        <tbody><tr><td>1</td><td><code>package com.javacourse2018.lw03.service;</code></td><td>1</td><td><code>package com.javacourse2018.lw03.service;</code></td></tr><tr><td>2</td><td><code></code></td><td>2</td><td><code></code></td></tr><tr><td>3</td><td><code>import com.javacourse2018.lw03.model.*;</code></td><td>3</td><td><code>import com.javacourse2018.lw03.model.*;</code></td></tr><tr><td>4</td><td><code>import com.javacourse2018.lw03.utils.Utilites;</code></td><td>4</td><td><code>import com.javacourse2018.lw03.utils.Utilites;</code></td></tr><tr><td>5</td><td><code></code></td><td>5</td><td><code></code></td></tr><tr><td>6</td><td><code>import java.util.Arrays;</code></td><td>6</td><td><code>import java.util.Arrays;</code></td></tr><tr><td>7</td><td><code>import java.util.List;</code></td><td>7</td><td><code>import java.util.List;</code></td></tr><tr><td>8</td><td><code>import java.util.Stack;</code></td><td>8</td><td><code>import java.util.Stack;</code></td></tr><tr><td>9</td><td><code></code></td><td>9</td><td><code></code></td></tr><tr><td>10</td><td><code>public class FormulaCalculatorImpl implements PrefixFormCalculator {</code></td><td>10</td><td><code>public class FormulaCalculatorImpl implements PrefixFormCalculator {</code></td></tr><tr><td>11</td><td><code></code></td><td>11</td><td><code></code></td></tr><tr><td>12</td><td><code>    private final Stack<String> stack = new Stack<>();</code></td><td>12</td><td><code>    private final Stack<String> stack = new Stack<>();</code></td></tr><tr><td>13</td><td><code></code></td><td>13</td><td><code></code></td></tr><tr><td>14</td><td><code>     private Operands operands = new Operands();</code></td><td>14</td><td><code>     private Operands operands = new Operands();</code></td></tr><tr><td>15</td><td><code></code></td><td>15</td><td><code></code></td></tr><tr><td>16</td><td class="table-danger"><code>-    private String calculatonResult = "123";</code></td><td>16</td><td class="table-success"><code>+    private String calculatonResult = "";</code></td></tr><tr><td>17</td><td><code></code></td><td>17</td><td><code></code></td></tr><tr><td> </td><td><code></code></td><td>18</td><td class="table-success"><code>+    private Spreadsheet spreadsheet;</code></td></tr><tr><td>18</td><td><code></code></td><td>19</td><td><code></code></td></tr><tr><td>19</td><td><code>     public FormulaCalculatorImpl(Spreadsheet spreadsheet) {</code></td><td>20</td><td><code>     public FormulaCalculatorImpl(Spreadsheet spreadsheet) {</code></td></tr><tr><td>20</td><td><code>         this.spreadsheet = spreadsheet;</code></td><td>21</td><td><code>         this.spreadsheet = spreadsheet;</code></td></tr><tr><td>21</td><td><code>     }</code></td><td>22</td><td><code>     }</code></td></tr><tr><td>22</td><td><code></code></td><td>23</td><td><code></code></td></tr><tr><td> </td><td><code></code></td><td>24</td><td class="table-success"><code>+    @Override</code></td></tr><tr><td>23</td><td><code>     public String getCalculationResult() {</code></td><td>25</td><td><code>     public String getCalculationResult() {</code></td></tr><tr><td>24</td><td><code>         return calculatonResult;</code></td><td>26</td><td><code>         return calculatonResult;</code></td></tr><tr><td>25</td><td><code>     }</code></td><td>27</td><td><code>     }</code></td></tr><tr><td>26</td><td><code></code></td><td>28</td><td><code></code></td></tr><tr><td>27</td><td><code>     @Override</code></td><td>29</td><td><code>     @Override</code></td></tr><tr><td>28</td><td class="table-danger"><code>-    public void calculate(String formula) {</code></td><td>30</td><td class="table-success"><code>+    public void calculate(String formula) throws IllegalArgumentException, IndexOutOfBoundsException {</code></td></tr><tr><td>29</td><td><code>         formula = formula.replaceAll("[\\(\\)]", "");</code></td><td>31</td><td><code>         formula = formula.replaceAll("[\\(\\)]", "");</code></td></tr><tr><td>30</td><td><code>         List<String> elements = Arrays.asList(formula.split(" "));</code></td><td>32</td><td><code>         List<String> elements = Arrays.asList(formula.split(" "));</code></td></tr><tr><td>31</td><td><code>         for (int i = elements.size() - 1; i != 0; --i) {</code></td><td>33</td><td><code>         for (int i = elements.size() - 1; i != 0; --i) {</code></td></tr><tr><td>32</td><td><code>            String item = elements.get(i);</code></td><td>34</td><td><code>            String item = elements.get(i);</code></td></tr><tr><td>33</td><td><code>             if (item.equals("")) {</code></td><td>35</td><td><code>             if (item.equals("")) {</code></td></tr><tr><td>34</td><td><code>                 continue;</code></td><td>36</td><td><code>                 continue;</code></td></tr><tr><td>35</td><td><code>             }</code></td><td>37</td><td><code>             }</code></td></tr><tr><td> </td><td><code></code></td><td>38</td><td class="table-success"><code>+            if (!item.contains(Operation.operationToString(Operation.ADDITION))</code></td></tr><tr><td> </td><td><code></code></td><td>39</td><td class="table-success"><code>+                    && !item.contains(Operation.operationToString(Operation.SUBTRACTION))</code></td></tr><tr><td> </td><td><code></code></td><td>40</td><td class="table-success"><code>+                    && !item.contains(Operation.operationToString(Operation.MULTIPLICATION))</code></td></tr><tr><td> </td><td><code></code></td><td>41</td><td class="table-success"><code>+                    && !item.contains(Operation.operationToString(Operation.DIVISION))) {</code></td></tr><tr><td> </td><td><code></code></td><td>42</td><td class="table-success"><code>+                this.stack.push(item);</code></td></tr><tr><td> </td><td><code></code></td><td>43</td><td class="table-success"><code>+                continue;</code></td></tr><tr><td> </td><td><code></code></td><td>44</td><td class="table-success"><code>+            }</code></td></tr><tr><td>36</td><td><code>             if (item.length() != 1) {</code></td><td>45</td><td><code>             if (item.length() != 1) {</code></td></tr><tr><td>37</td><td><code>                 throw new IllegalArgumentException("Incorrect operation: " + item);</code></td><td>46</td><td><code>                 throw new IllegalArgumentException("Incorrect operation: " + item);</code></td></tr><tr><td>38</td><td><code>             }</code></td><td>47</td><td><code>             }</code></td></tr><tr><td>39</td><td><code>            Operation operation = Operation.createFromCharacter(item.toCharArray()[0]);</code></td><td>48</td><td><code>            Operation operation = Operation.createFromCharacter(item.toCharArray()[0]);</code></td></tr><tr><td>40</td><td><code>            this.expressionEvaluationManager(operation);</code></td><td>49</td><td><code>            this.expressionEvaluationManager(operation);</code></td></tr><tr><td>41</td><td><code>         }</code></td><td>50</td><td><code>         }</code></td></tr><tr><td>42</td><td><code>         if (this.stack.size() == 1) {</code></td><td>51</td><td><code>         if (this.stack.size() == 1) {</code></td></tr><tr><td>43</td><td><code>             this.calculatonResult = this.stack.pop();</code></td><td>52</td><td><code>             this.calculatonResult = this.stack.pop();</code></td></tr><tr><td> </td><td><code></code></td><td>53</td><td class="table-success"><code>+            return;</code></td></tr><tr><td>44</td><td><code>         }</code></td><td>54</td><td><code>         }</code></td></tr><tr><td> </td><td><code></code></td><td>55</td><td class="table-success"><code>+        throw new IllegalArgumentException("Incorrect formula." + formula);</code></td></tr><tr><td>45</td><td><code>     }</code></td><td>56</td><td><code>     }</code></td></tr><tr><td>46</td><td><code></code></td><td>57</td><td><code></code></td></tr><tr><td>47</td><td><code>     @Override</code></td><td>58</td><td><code>     @Override</code></td></tr><tr><td>48</td><td><code>    public void clearResult() {</code></td><td>59</td><td><code>    public void clearResult() {</code></td></tr><tr><td>49</td><td><code>        this.operands.clear();</code></td><td>60</td><td><code>        this.operands.clear();</code></td></tr><tr><td>50</td><td><code>        this.calculatonResult = "";</code></td><td>61</td><td><code>        this.calculatonResult = "";</code></td></tr><tr><td>51</td><td><code>         this.stack.clear();</code></td><td>62</td><td><code>         this.stack.clear();</code></td></tr><tr><td>52</td><td><code>     }</code></td><td>63</td><td><code>     }</code></td></tr><tr><td>53</td><td><code></code></td><td>64</td><td><code></code></td></tr><tr><td>54</td><td class="table-danger"><code>-    private void expressionEvaluationManager(Operation operation) {</code></td><td>65</td><td class="table-success"><code>+    private void expressionEvaluationManager(Operation operation) throws IllegalArgumentException, IndexOutOfBoundsException {</code></td></tr><tr><td>55</td><td><code>         this.operands.clear();</code></td><td>66</td><td><code>         this.operands.clear();</code></td></tr><tr><td>56</td><td><code>         switch (operation) {</code></td><td>67</td><td><code>         switch (operation) {</code></td></tr><tr><td>57</td><td><code>             case ADDITION:</code></td><td>68</td><td><code>             case ADDITION:</code></td></tr><tr><td>58</td><td><code>                this.additionHandler();</code></td><td>69</td><td><code>                this.additionHandler();</code></td></tr><tr><td>59</td><td><code>                break;</code></td><td>70</td><td><code>                break;</code></td></tr><tr><td>60</td><td><code>            case SUBTRACTION:</code></td><td>71</td><td><code>            case SUBTRACTION:</code></td></tr><tr><td>61</td><td><code>                this.subtractionHandler();</code></td><td>72</td><td><code>                this.subtractionHandler();</code></td></tr><tr><td>62</td><td><code>                break;</code></td><td>73</td><td><code>                break;</code></td></tr><tr><td>63</td><td><code>            case MULTIPLICATION:</code></td><td>74</td><td><code>            case MULTIPLICATION:</code></td></tr><tr><td>64</td><td><code>                this.multiplicationHandler();</code></td><td>75</td><td><code>                this.multiplicationHandler();</code></td></tr><tr><td>65</td><td><code>                break;</code></td><td>76</td><td><code>                break;</code></td></tr><tr><td>66</td><td><code>             case DIVISION:</code></td><td>77</td><td><code>             case DIVISION:</code></td></tr><tr><td>67</td><td><code>                 this.divisionHandler();</code></td><td>78</td><td><code>                 this.divisionHandler();</code></td></tr><tr><td>68</td><td><code>                 break;</code></td><td>79</td><td><code>                 break;</code></td></tr><tr><td>69</td><td class="table-danger"><code>-			case SOME:</code></td><td> </td><td><code></code></td></tr><tr><td>70</td><td class="table-danger"><code>-				break;</code></td><td> </td><td><code></code></td></tr><tr><td>71</td><td><code>             default:</code></td><td>80</td><td><code>             default:</code></td></tr><tr><td>72</td><td><code>                 break;</code></td><td>81</td><td><code>                 break;</code></td></tr><tr><td>73</td><td><code>         }</code></td><td>82</td><td><code>         }</code></td></tr><tr><td>74</td><td><code></code></td><td>83</td><td><code></code></td></tr><tr><td>75</td><td><code>    }</code></td><td>84</td><td><code>    }</code></td></tr><tr><td>76</td><td><code></code></td><td>85</td><td><code></code></td></tr><tr><td>77</td><td><code>    private void divisionHandler() throws IllegalArgumentException {</code></td><td>86</td><td><code>    private void divisionHandler() throws IllegalArgumentException {</code></td></tr><tr><td>78</td><td><code>        this.handleOperands(false);</code></td><td>87</td><td><code>        this.handleOperands(false);</code></td></tr><tr><td>79</td><td><code>        if ((!this.operands.getFirst().equals(this.operands.zero())</code></td><td>88</td><td><code>        if ((!this.operands.getFirst().equals(this.operands.zero())</code></td></tr><tr><td>80</td><td><code>                && !this.operands.getSecond().equals(this.operands.zero()))) {</code></td><td>89</td><td><code>                && !this.operands.getSecond().equals(this.operands.zero()))) {</code></td></tr><tr><td>81</td><td><code>            stack.push(Double.toString(this.operands.getFirst() / this.operands.getSecond()));</code></td><td>90</td><td><code>            stack.push(Double.toString(this.operands.getFirst() / this.operands.getSecond()));</code></td></tr><tr><td>82</td><td><code>         } else {</code></td><td>91</td><td><code>         } else {</code></td></tr><tr><td>83</td><td><code>             throw new IllegalArgumentException("Error in the formula.");</code></td><td>92</td><td><code>             throw new IllegalArgumentException("Error in the formula.");</code></td></tr><tr><td>84</td><td><code>         }</code></td><td>93</td><td><code>         }</code></td></tr><tr><td>85</td><td class="table-danger"><code>-		if (stack.isEmpty()) {</code></td><td> </td><td><code></code></td></tr><tr><td>86</td><td class="table-danger"><code>-			return;</code></td><td> </td><td><code></code></td></tr><tr><td>87</td><td class="table-danger"><code>-		}</code></td><td> </td><td><code></code></td></tr><tr><td>88</td><td><code>     }</code></td><td>94</td><td><code>     }</code></td></tr><tr><td>89</td><td><code></code></td><td>95</td><td><code></code></td></tr><tr><td>90</td><td><code>     private void multiplicationHandler() throws IllegalArgumentException {</code></td><td>96</td><td><code>     private void multiplicationHandler() throws IllegalArgumentException {</code></td></tr><tr><td>91</td><td><code>        this.handleOperands(false);</code></td><td>97</td><td><code>        this.handleOperands(false);</code></td></tr><tr><td>92</td><td><code>        if ((!this.operands.getFirst().equals(this.operands.zero())</code></td><td>98</td><td><code>        if ((!this.operands.getFirst().equals(this.operands.zero())</code></td></tr><tr><td>93</td><td><code>                && !this.operands.getSecond().equals(this.operands.zero()))) {</code></td><td>99</td><td><code>                && !this.operands.getSecond().equals(this.operands.zero()))) {</code></td></tr><tr><td>94</td><td><code>            stack.push(Double.toString(this.operands.getFirst() * this.operands.getSecond()));</code></td><td>100</td><td><code>            stack.push(Double.toString(this.operands.getFirst() * this.operands.getSecond()));</code></td></tr><tr><td>95</td><td><code>        } else {</code></td><td>101</td><td><code>        } else {</code></td></tr><tr><td>96</td><td><code>            throw new IllegalArgumentException("Error in the formula.");</code></td><td>102</td><td><code>            throw new IllegalArgumentException("Error in the formula.");</code></td></tr><tr><td>97</td><td><code>         }</code></td><td>103</td><td><code>         }</code></td></tr><tr><td>98</td><td><code>     }</code></td><td>104</td><td><code>     }</code></td></tr><tr><td>99</td><td><code></code></td><td>105</td><td><code></code></td></tr><tr><td> </td><td><code></code></td><td>106</td><td class="table-success"><code>+    private void subtractionHandler() throws IllegalArgumentException {</code></td></tr><tr><td> </td><td><code></code></td><td>107</td><td class="table-success"><code>+        this.handleOperands(false);</code></td></tr><tr><td> </td><td><code></code></td><td>108</td><td class="table-success"><code>+        if ((!this.operands.getFirst().equals(this.operands.zero())</code></td></tr><tr><td> </td><td><code></code></td><td>109</td><td class="table-success"><code>+                && !this.operands.getSecond().equals(this.operands.zero()))) {</code></td></tr><tr><td> </td><td><code></code></td><td>110</td><td class="table-success"><code>+            stack.push(Double.toString(this.operands.getFirst() - this.operands.getSecond()));</code></td></tr><tr><td> </td><td><code></code></td><td>111</td><td class="table-success"><code>+        } else {</code></td></tr><tr><td> </td><td><code></code></td><td>112</td><td class="table-success"><code>+            throw new IllegalArgumentException("Error in the formula.");</code></td></tr><tr><td> </td><td><code></code></td><td>113</td><td class="table-success"><code>+        }</code></td></tr><tr><td> </td><td><code></code></td><td>114</td><td class="table-success"><code>+    }</code></td></tr><tr><td> </td><td><code></code></td><td>115</td><td class="table-success"><code>+</code></td></tr><tr><td> </td><td><code></code></td><td>116</td><td class="table-success"><code>+    private void additionHandler() {</code></td></tr><tr><td> </td><td><code></code></td><td>117</td><td class="table-success"><code>+        this.handleOperands(true);</code></td></tr><tr><td> </td><td><code></code></td><td>118</td><td class="table-success"><code>+        if ((!this.operands.getFirst().equals(this.operands.zero())</code></td></tr><tr><td> </td><td><code></code></td><td>119</td><td class="table-success"><code>+                && !this.operands.getSecond().equals(this.operands.zero()))) {</code></td></tr><tr><td> </td><td><code></code></td><td>120</td><td class="table-success"><code>+            stack.push(Double.toString(this.operands.getFirst() + this.operands.getSecond()));</code></td></tr><tr><td> </td><td><code></code></td><td>121</td><td class="table-success"><code>+            return;</code></td></tr><tr><td> </td><td><code></code></td><td>122</td><td class="table-success"><code>+        }</code></td></tr><tr><td> </td><td><code></code></td><td>123</td><td class="table-success"><code>+        stack.push(getTheSumOfTwoOperands());</code></td></tr><tr><td> </td><td><code></code></td><td>124</td><td class="table-success"><code>+    }</code></td></tr><tr><td> </td><td><code></code></td><td>125</td><td class="table-success"><code>+</code></td></tr><tr><td>100</td><td><code>     private void handleOperands(Boolean isSum) {</code></td><td>126</td><td><code>     private void handleOperands(Boolean isSum) {</code></td></tr><tr><td>101</td><td><code>         this.operands.setFirstStr(stack.pop());</code></td><td>127</td><td><code>         this.operands.setFirstStr(stack.pop());</code></td></tr><tr><td>102</td><td><code>         this.operands.setSecondStr(stack.pop());</code></td><td>128</td><td><code>         this.operands.setSecondStr(stack.pop());</code></td></tr><tr><td>103</td><td><code>        this.checkOperandsForNumbers();</code></td><td>129</td><td><code>        this.checkOperandsForNumbers();</code></td></tr><tr><td>104</td><td><code>        if (Command.isValidCoordinate(this.operands.getFirstStr())) {</code></td><td>130</td><td><code>        if (Command.isValidCoordinate(this.operands.getFirstStr())) {</code></td></tr><tr><td>105</td><td><code>            this.handleFirstCoordinate(isSum);</code></td><td>131</td><td><code>            this.handleFirstCoordinate(isSum);</code></td></tr><tr><td>106</td><td><code>         }</code></td><td>132</td><td><code>         }</code></td></tr><tr><td>107</td><td><code>         if (Command.isValidCoordinate(this.operands.getSecondStr())) {</code></td><td>133</td><td><code>         if (Command.isValidCoordinate(this.operands.getSecondStr())) {</code></td></tr><tr><td>108</td><td><code>             this.handleSecondCoordinate(isSum);</code></td><td>134</td><td><code>             this.handleSecondCoordinate(isSum);</code></td></tr><tr><td>109</td><td class="table-danger"><code>-        }</code></td><td> </td><td><code></code></td></tr><tr><td>110</td><td class="table-danger"><code>-		        if (Command.isValidCoordinate(this.operands.getSecondStr())) {</code></td><td> </td><td><code></code></td></tr><tr><td>111</td><td class="table-danger"><code>-            this.handleSecondCoordinate(isSum);</code></td><td> </td><td><code></code></td></tr><tr><td>112</td><td class="table-danger"><code>-        }</code></td><td> </td><td><code></code></td></tr><tr><td>113</td><td class="table-danger"><code>-		        if (Command.isValidCoordinate(this.operands.getSecondStr())) {</code></td><td> </td><td><code></code></td></tr><tr><td>114</td><td class="table-danger"><code>-            this.handleSecondCoordinate(isSum);</code></td><td> </td><td><code></code></td></tr><tr><td>115</td><td><code>         }</code></td><td>135</td><td><code>         }</code></td></tr><tr><td>116</td><td><code>     }</code></td><td>136</td><td><code>     }</code></td></tr><tr><td>117</td><td><code></code></td><td>137</td><td><code></code></td></tr><tr><td>118</td><td><code>    private String getTheSumOfTwoOperands() {</code></td><td>138</td><td><code>    private String getTheSumOfTwoOperands() {</code></td></tr><tr><td>119</td><td><code>        String result = "";</code></td><td>139</td><td><code>        String result = "";</code></td></tr><tr><td>120</td><td><code>        if (this.operands.getSecond().equals(this.operands.zero())</code></td><td>140</td><td><code>        if (this.operands.getSecond().equals(this.operands.zero())</code></td></tr><tr><td>121</td><td><code>                && this.operands.getFirst().equals(this.operands.zero())) {</code></td><td>141</td><td><code>                && this.operands.getFirst().equals(this.operands.zero())) {</code></td></tr><tr><td>122</td><td><code>            result = this.operands.getFirstStr() + this.operands.getSecondStr() ;</code></td><td>142</td><td><code>            result = this.operands.getFirstStr() + this.operands.getSecondStr() ;</code></td></tr><tr><td>123</td><td><code>        } else {</code></td><td>143</td><td><code>        } else {</code></td></tr><tr><td>124</td><td><code>            if (this.operands.getFirst().equals(this.operands.zero())) {</code></td><td>144</td><td><code>            if (this.operands.getFirst().equals(this.operands.zero())) {</code></td></tr><tr><td>125</td><td><code>                result = this.operands.getFirstStr() + this.operands.getSecond().toString();</code></td><td>145</td><td><code>                result = this.operands.getFirstStr() + this.operands.getSecond().toString();</code></td></tr><tr><td>126</td><td><code>            } else if (this.operands.getSecond().equals(this.operands.zero())) {</code></td><td>146</td><td><code>            } else if (this.operands.getSecond().equals(this.operands.zero())) {</code></td></tr><tr><td>127</td><td><code>                result = this.operands.getFirst().toString() + this.operands.getSecondStr();</code></td><td>147</td><td><code>                result = this.operands.getFirst().toString() + this.operands.getSecondStr();</code></td></tr><tr><td>128</td><td><code>            } else {</code></td><td>148</td><td><code>            } else {</code></td></tr><tr><td>129</td><td><code>                result = this.operands.getFirstStr() + this.operands.getSecondStr();</code></td><td>149</td><td><code>                result = this.operands.getFirstStr() + this.operands.getSecondStr();</code></td></tr><tr><td>130</td><td><code>            }</code></td><td>150</td><td><code>            }</code></td></tr><tr><td>131</td><td><code>        }</code></td><td>151</td><td><code>        }</code></td></tr><tr><td>132</td><td><code>        return result;</code></td><td>152</td><td><code>        return result;</code></td></tr><tr><td>133</td><td><code>    }</code></td><td>153</td><td><code>    }</code></td></tr><tr><td>134</td><td><code></code></td><td>154</td><td><code></code></td></tr><tr><td>135</td><td><code>    //  @param class fields</code></td><td>155</td><td><code>    //  @param class fields</code></td></tr><tr><td>136</td><td><code>    private void checkOperandsForNumbers() {</code></td><td>156</td><td><code>    private void checkOperandsForNumbers() {</code></td></tr><tr><td>137</td><td><code>        if (Utilites.isNumber(this.operands.getFirstStr())) {</code></td><td>157</td><td><code>        if (Utilites.isNumber(this.operands.getFirstStr())) {</code></td></tr><tr><td>138</td><td><code>            this.operands.setFirst(Double.parseDouble(this.operands.getFirstStr()));</code></td><td>158</td><td><code>            this.operands.setFirst(Double.parseDouble(this.operands.getFirstStr()));</code></td></tr><tr><td>139</td><td><code>        }</code></td><td>159</td><td><code>        }</code></td></tr><tr><td>140</td><td><code>        if (Utilites.isNumber(this.operands.getSecondStr())) {</code></td><td>160</td><td><code>        if (Utilites.isNumber(this.operands.getSecondStr())) {</code></td></tr><tr><td>141</td><td><code>            this.operands.setSecond(Double.parseDouble(this.operands.getSecondStr()));</code></td><td>161</td><td><code>            this.operands.setSecond(Double.parseDouble(this.operands.getSecondStr()));</code></td></tr><tr><td>142</td><td><code>        }</code></td><td>162</td><td><code>        }</code></td></tr><tr><td>143</td><td><code>     }</code></td><td>163</td><td><code>     }</code></td></tr><tr><td>144</td><td><code></code></td><td>164</td><td><code></code></td></tr><tr><td>145</td><td><code>     //  @param class fields</code></td><td>165</td><td><code>     //  @param class fields</code></td></tr><tr><td>146</td><td class="table-danger"><code>-    private void handleFirstCoordinate(Boolean isSum) {</code></td><td>166</td><td class="table-success"><code>+    private void handleFirstCoordinate(Boolean isSum) throws IllegalArgumentException {</code></td></tr><tr><td>147</td><td><code>         String number = this.operands.getFirstStr().substring(1, this.operands.getFirstStr().length());</code></td><td>167</td><td><code>         String number = this.operands.getFirstStr().substring(1, this.operands.getFirstStr().length());</code></td></tr><tr><td>148</td><td><code>         Position position = new Position(this.operands.getFirstStr().toUpperCase().charAt(0), Integer.parseInt(number));</code></td><td>168</td><td><code>         Position position = new Position(this.operands.getFirstStr().toUpperCase().charAt(0), Integer.parseInt(number));</code></td></tr><tr><td> </td><td><code></code></td><td>169</td><td class="table-success"><code>+        Cell cell;</code></td></tr><tr><td> </td><td><code></code></td><td>170</td><td class="table-success"><code>+        cell = this.spreadsheet.getCell(position);</code></td></tr><tr><td> </td><td><code></code></td><td>171</td><td class="table-success"><code>+        String cellValue = cell.getValue();</code></td></tr><tr><td>149</td><td><code>         if (Utilites.isNumber(cellValue)) {</code></td><td>172</td><td><code>         if (Utilites.isNumber(cellValue)) {</code></td></tr><tr><td>150</td><td><code>             this.operands.setFirst(Double.parseDouble(cell.getValue()));</code></td><td>173</td><td><code>             this.operands.setFirst(Double.parseDouble(cell.getValue()));</code></td></tr><tr><td>151</td><td><code>         } else {</code></td><td>174</td><td><code>         } else {</code></td></tr><tr><td>152</td><td><code>             if (isSum) {</code></td><td>175</td><td><code>             if (isSum) {</code></td></tr><tr><td>153</td><td><code>                 this.operands.setFirstStr(cellValue);</code></td><td>176</td><td><code>                 this.operands.setFirstStr(cellValue);</code></td></tr><tr><td> </td><td><code></code></td><td>177</td><td class="table-success"><code>+            } else {</code></td></tr><tr><td> </td><td><code></code></td><td>178</td><td class="table-success"><code>+                throw new IllegalArgumentException("Error in the formula.");</code></td></tr><tr><td>154</td><td><code>             }</code></td><td>179</td><td><code>             }</code></td></tr><tr><td>155</td><td><code>         }</code></td><td>180</td><td><code>         }</code></td></tr><tr><td>156</td><td><code>         Position pos = cell.getPosition();</code></td><td>181</td><td><code>         Position pos = cell.getPosition();</code></td></tr><tr><td>157</td><td><code>        if (!this.spreadsheet.getCellsIncludedInTheFormula().contains(pos)) {</code></td><td>182</td><td><code>        if (!this.spreadsheet.getCellsIncludedInTheFormula().contains(pos)) {</code></td></tr><tr><td>158</td><td><code>            this.spreadsheet.addPositionToCellsIncludedInTheFormula(pos);</code></td><td>183</td><td><code>            this.spreadsheet.addPositionToCellsIncludedInTheFormula(pos);</code></td></tr><tr><td>159</td><td><code>        }</code></td><td>184</td><td><code>        }</code></td></tr><tr><td>160</td><td><code>    }</code></td><td>185</td><td><code>    }</code></td></tr><tr><td>161</td><td><code></code></td><td>186</td><td><code></code></td></tr><tr><td>162</td><td><code>    private void handleSecondCoordinate(Boolean isSum) throws IllegalArgumentException {</code></td><td>187</td><td><code>    private void handleSecondCoordinate(Boolean isSum) throws IllegalArgumentException {</code></td></tr><tr><td>163</td><td><code>        String number = this.operands.getSecondStr().substring(1, this.operands.getSecondStr().length());</code></td><td>188</td><td><code>        String number = this.operands.getSecondStr().substring(1, this.operands.getSecondStr().length());</code></td></tr><tr><td>164</td><td><code>        Position position = new Position(this.operands.getSecondStr().toUpperCase().charAt(0), Integer.parseInt(number));</code></td><td>189</td><td><code>        Position position = new Position(this.operands.getSecondStr().toUpperCase().charAt(0), Integer.parseInt(number));</code></td></tr><tr><td>165</td><td><code>         Cell cell;</code></td><td>190</td><td><code>         Cell cell;</code></td></tr><tr><td>166</td><td><code>         cell = this.spreadsheet.getCell(position);</code></td><td>191</td><td><code>         cell = this.spreadsheet.getCell(position);</code></td></tr><tr><td>167</td><td><code>         String cellValue = cell.getValue();</code></td><td>192</td><td><code>         String cellValue = cell.getValue();</code></td></tr><tr><td> </td><td><code></code></td><td>193</td><td class="table-success"><code>+        if (Utilites.isNumber(cellValue)) {</code></td></tr><tr><td> </td><td><code></code></td><td>194</td><td class="table-success"><code>+            this.operands.setSecond(Double.parseDouble(cell.getValue()));</code></td></tr><tr><td> </td><td><code></code></td><td>195</td><td class="table-success"><code>+        } else {</code></td></tr><tr><td> </td><td><code></code></td><td>196</td><td class="table-success"><code>+            if (isSum) {</code></td></tr><tr><td> </td><td><code></code></td><td>197</td><td class="table-success"><code>+                this.operands.setSecondStr(cellValue);</code></td></tr><tr><td> </td><td><code></code></td><td>198</td><td class="table-success"><code>+            } else {</code></td></tr><tr><td> </td><td><code></code></td><td>199</td><td class="table-success"><code>+                throw new IllegalArgumentException("Error in the formula.");</code></td></tr><tr><td> </td><td><code></code></td><td>200</td><td class="table-success"><code>+            }</code></td></tr><tr><td> </td><td><code></code></td><td>201</td><td class="table-success"><code>+        }</code></td></tr><tr><td>168</td><td><code>         Position pos = cell.getPosition();</code></td><td>202</td><td><code>         Position pos = cell.getPosition();</code></td></tr><tr><td>169</td><td><code>         if (!this.spreadsheet.getCellsIncludedInTheFormula().contains(pos)) {</code></td><td>203</td><td><code>         if (!this.spreadsheet.getCellsIncludedInTheFormula().contains(pos)) {</code></td></tr><tr><td>170</td><td><code>             this.spreadsheet.addPositionToCellsIncludedInTheFormula(pos);</code></td><td>204</td><td><code>             this.spreadsheet.addPositionToCellsIncludedInTheFormula(pos);</code></td></tr><tr><td>171</td><td class="table-danger"><code>-        }</code></td><td> </td><td><code></code></td></tr><tr><td>172</td><td class="table-danger"><code>-		        if (!this.spreadsheet.getCellsIncludedInTheFormula().contains(pos)) {</code></td><td> </td><td><code></code></td></tr><tr><td>173</td><td class="table-danger"><code>-            this.spreadsheet.addPositionToCellsIncludedInTheFormula(pos);</code></td><td> </td><td><code></code></td></tr><tr><td>174</td><td class="table-danger"><code>-        }</code></td><td> </td><td><code></code></td></tr><tr><td>175</td><td class="table-danger"><code>-		        if (!this.spreadsheet.getCellsIncludedInTheFormula().contains(pos)) {</code></td><td> </td><td><code></code></td></tr><tr><td>176</td><td class="table-danger"><code>-            this.spreadsheet.addPositionToCellsIncludedInTheFormula(pos);</code></td><td> </td><td><code></code></td></tr><tr><td>177</td><td class="table-danger"><code>-        }</code></td><td> </td><td><code></code></td></tr><tr><td>178</td><td class="table-danger"><code>-		        if (!this.spreadsheet.getCellsIncludedInTheFormula().contains(pos)) {</code></td><td> </td><td><code></code></td></tr><tr><td>179</td><td class="table-danger"><code>-            this.spreadsheet.addPositionToCellsIncludedInTheFormula(pos);</code></td><td> </td><td><code></code></td></tr><tr><td>180</td><td><code>         }</code></td><td>205</td><td><code>         }</code></td></tr><tr><td>181</td><td><code>     }</code></td><td>206</td><td><code>     }</code></td></tr><tr><td>182</td><td><code>}</code></td><td>207</td><td><code>}</code></td></tr></tbody>      </table>    <!-- Optional JavaScript -->    <!-- jQuery first, then Popper.js, then Bootstrap JS -->    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>  </body></html>